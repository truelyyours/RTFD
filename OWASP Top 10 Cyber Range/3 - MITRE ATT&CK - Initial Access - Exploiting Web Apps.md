In the Cipher Block Chaining (CBC) mode, the input to the encryption algorithm is the XOR of the current plaintext block and the preceding ciphertext block; the same key is used for each block. In effect, they are chained together with the processing of the sequence of plaintext blocks. An initialization vector (IV) is XORed with the first plaintext block to produce the first ciphertext block. The CBC mode requires that the last block be padded to full b bits if it is a partial block.
![[qkuletsa.jpg]]
For decryption, each cipher block is passed through the decryption algorithm. The result is XORed with the preceding ciphertext block to produce the plaintext block. On decryption, the IV is XORed with the current output of the decryption algorithm to recover the first block of plaintext. The IV is a data block that is the same size as the cipher block. The IV must be known to both the sender and receiver but be unpredictable by a third party.

![[oqar3vum.jpg]]
To get started, open a new browser window and visit the padding-oracle.com webserver on port 5001
`padding-oracle.com:5001

Click on the Register option and move to the next step.
# Start BurpSuite

Burp Suite is a tool that comes in helpful when attacking websites and web applications. Burp Suite acts as a proxy, controlling the flow of traffic between an attacker's browser and the target.
## Configure Firefox
Click on 'Manual proxy configuration'. Afterward, set the IP address to `127.0.0.1` and the Burp Proxy listener port to `8080`. To finish, click OK to close all of the options dialogs.
# Create a new user

Return to the web application and enter the following credentials to Register.
Username: `student`
Password: `computer`

Go back to Burpsuite and ensure that the Interception is on before submitting. Forward the first request sent to the webserver by clicking on the Forward button. This POST request will contain the values typed in the input fields.
# Retrieve Authentication Cookie

The interesting request is the next one, a GET request containing the value of the authentication cookie.
![[Pasted image 20250814192457.png]]

Right-click on the request and choose "Send to Repeater" from the context menu. Repeater is a tool for manually manipulating and reissuing HTTP requests and analyzing the application's responses. Now, visit the Repeater tab and click the Send button.
# Decrypt The Value Of Auth Key

Copy the value of the _auth_ cookie and open a new terminal.

A tool called **PadBuster** is incredibly effective at exploiting the **Padding Oracle Vulnerability**. The block size of the cipher is set to **8**, and the sample is **base64** encoded.
`padbuster http://padding-oracle.com:5001/login.php 'auth' 8 --cookies auth='auth' encoding 0

Replace every placeholder named 'auth' with the cookie value you just copied (don't leave the literal word 'auth' in the command):
Type 2 when it asks for an ID that matches the error condition.
# Encrypt The Auth Key as Admin User

**PadBuster** showed that the cookie contains the user's username. The aim is to escalate to the admin user. Therefore, using PadBuster's plaintext argument, change the username to admin and try to encrypt it using the tool.
`padbuster http://padding-oracle.com:5001/login.php '<actual_cookie>' 8 --cookies auth='<actual_cookie>' encoding 0 -plaintext user=admin
Type 2 when prompted for an ID that matches the error condition.

![[Pasted image 20250814194140.png]]
# Login as Admin

Copy the generated cookie shown in the terminal and return to the Repeater. Modify the captured request's authentication cookie to the one generated using PadBuster.
After updating the authentication cookie value, click the Send button to send it to the server. When received, the response is displayed, showing that the user has successfully logged in as admin.
# Introduction to Server-Side Template Injection

**Server-Side Template Injection**, also known as SSTI, is a server-side vulnerability that arises due to no or poor validation of user passed input and it being inserted into a template engine. Most web applications use different template engines to provide dynamic data functionality, and there are several template engines written in different programming languages such as PHP (Smarty, Twig), Java (Velocity, Freemaker), Python (Jinja, Mako). The SSTI vulnerability can arise due to poor validation or a vulnerable template engine version.

Successful SSTI can expose a web application to different attack vectors such as XSS, HTML injections, or even command execution. In some cases, an attacker can compromise the complete web server by injecting arbitrary commands and obtaining a reverse shell on the target system.

Open a new tab and visit the template-injection.com website on port 5000.
`template-injection.com:5000

A login page is presented. Type the following default credentials (username: admin, password: admin) to continue.
# Detect SSTI

The following path should be taken to perform an efficient attack process of this vulnerability.
![[30z4qeg9.jpg]]

The first step towards exploitation is to detect that a web application is vulnerable. Submitting mathematical operations within a template expression is one of the easiest ways of detecting whether a server is vulnerable to template injection or not.
